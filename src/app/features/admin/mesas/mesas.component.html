<div class="mesas-container">

  <h2>Gestión de Mesas</h2>

  <div class="form-card" *ngIf="esAdmin">
    <h3>Crear nueva mesa</h3>

    <form (ngSubmit)="crearMesa()">
      <input
        type="number"
        placeholder="Número de mesa"
        [(ngModel)]="nuevaMesa.numero"
        name="numero"
        required
      />
      <button type="submit">Crear mesa</button>
    </form>
  </div>

  <div class="grid">
    <div
      class="mesa-card"
      *ngFor="let mesa of mesas"
      [ngClass]="mesa.estado"
      (click)="seleccionarMesa(mesa)"
    >
      <h3>Mesa {{ mesa.numero }}</h3>
      <p class="estado">{{ mesa.estado }}</p>

      <div class="acciones">
        <button *ngIf="mesa.estado !== 'LIBRE'"
          (click)="cambiarEstado(mesa, 'LIBRE'); $event.stopPropagation()">
          Libre
        </button>

        <button *ngIf="mesa.estado !== 'OCUPADA'"
          (click)="cambiarEstado(mesa, 'OCUPADA'); $event.stopPropagation()">
          Ocupar
        </button>

        <button *ngIf="mesa.estado !== 'RESERVADA'"
          (click)="cambiarEstado(mesa, 'RESERVADA'); $event.stopPropagation()">
          Reservar
        </button>

        <button *ngIf="esAdmin"
          class="btn-eliminar"
          (click)="eliminarMesa(mesa.id); $event.stopPropagation()">
          Eliminar
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="pedidoActivo" class="pedido-panel">
    <h3>Pedido #{{ pedidoActivo.id }}</h3>

    <div class="pedido-layout">

      <div class="menu">
        <h4>Menú</h4>
        <ul>
          <li *ngFor="let plato of platos">
            {{ plato.nombre }} - S/ {{ plato.precio }}
            <button (click)="agregarPlato(plato)">Agregar</button>
          </li>
        </ul>
      </div>

      <div class="detalle">
        <h4>Detalle del pedido</h4>

        <table class="tabla-pedido">
          <tr>
            <th>Plato</th>
            <th>Cant.</th>
            <th>Precio</th>
            <th>Subtotal</th>
          </tr>

          <tr *ngFor="let item of itemsPedido">
            <td>{{ item.menuItem.nombre }}</td>
            <td>
              <button (click)="agregarPlato(item.menuItem)">+</button>
              {{ item.cantidad }}
              <button (click)="quitarPlato(item.menuItem)">-</button>
            </td>

            <td>S/ {{ item.precio }}</td>
            <td>S/ {{ item.precio * item.cantidad }}</td>
          </tr>
        </table>

        <h4>Total: S/ {{ pedidoActivo.total }}</h4>
      </div>

    </div>
  </div>

</div>


