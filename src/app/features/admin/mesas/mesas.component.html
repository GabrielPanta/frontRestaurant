<div class="mesas-container">

  <div class="header">
    <h2>Mesas</h2>

    <form class="form-inline" *ngIf="esAdmin" (ngSubmit)="crearMesa()">
      <input
        type="number"
        placeholder="N° mesa"
        [(ngModel)]="nuevaMesa.numero"
        name="numero"
        required>
      <button type="submit">Crear</button>
    </form>
  </div>

  <!-- GRID MESAS -->
  <div class="grid">
    <div class="mesa-card-wrapper" *ngFor="let mesa of mesas">

      <div
        class="mesa-card"
        [ngClass]="mesa.estado"
        (click)="abrirPedido(mesa)">

        <div class="mesa-numero">
          {{ mesa.numero }}
        </div>

        <div class="mesa-estado">
          {{ mesa.estado }}
        </div>

        <div
          class="mesa-activa"
          *ngIf="mesa.estado === 'OCUPADA'">
          Pedido activo
        </div>
      </div>

      <!-- ADMIN CONTROLES -->
      <div class="mesa-admin" *ngIf="esAdmin">
        <button
          (click)="cambiarEstado(mesa,'LIBRE'); $event.stopPropagation()"
          [disabled]="mesa.estado === 'OCUPADA'">
          Libre
        </button>

        <button
          (click)="cambiarEstado(mesa,'OCUPADA'); $event.stopPropagation()">
          Ocupar
        </button>

        <button
          (click)="cambiarEstado(mesa,'RESERVADA'); $event.stopPropagation()">
          Reservar
        </button>

        <button
          class="btn-eliminar"
          (click)="eliminarMesa(mesa.id); $event.stopPropagation()"
          [disabled]="mesa.estado === 'OCUPADA'">
          Eliminar
        </button>
      </div>

    </div>
  </div>
</div>


<!-- MODAL PEDIDO -->
<div class="modal-backdrop" *ngIf="mesaSeleccionada">
  <div class="modal">

    <header class="modal-header">
      <div>
        Mesa {{ mesaSeleccionada.numero }}
        <span class="pedido-id">
          {{ pedidoActivo?.id ? '#'+pedidoActivo.id : 'nuevo' }}
        </span>
      </div>

      <button class="btn-cerrar" (click)="cerrarModal()">×</button>
    </header>

    <div class="modal-body">

      <!-- MENU -->
      <div class="menu">
        <h4>Menú</h4>

        <div class="menu-scroll">
          <div
            class="menu-item"
            *ngFor="let plato of platos"
            (click)="agregarPlato(plato)">

            <span>{{ plato.nombre }}</span>
            <strong>S/ {{ plato.precio }}</strong>
          </div>
        </div>
      </div>

      <!-- PEDIDO -->
      <div class="detalle">
        <h4>Pedido</h4>

        <div class="detalle-scroll" *ngIf="itemsPedido.length > 0">
          <div
            class="item-ticket"
            *ngFor="let item of itemsPedido">

            <span>{{ item.menuItem.nombre }}</span>

            <div class="item-controls">
              <button (click)="quitarPlato(item.menuItem)">−</button>
              <span>{{ item.cantidad }}</span>
              <button (click)="agregarPlato(item.menuItem)">+</button>
            </div>

            <strong>S/ {{ item.precio * item.cantidad }}</strong>
          </div>
        </div>

        <div class="pedido-vacio" *ngIf="itemsPedido.length === 0">
          Sin productos
        </div>
      </div>

    </div>

    <footer class="modal-footer">
      <div class="total">
        Total S/ {{ pedidoActivo?.total || 0 }}
      </div>

      <button
        class="btn-cerrar-pedido"
        (click)="cerrarPedido()"
        [disabled]="itemsPedido.length === 0">
        Cerrar pedido
      </button>
    </footer>

  </div>
</div>




    
      
     
